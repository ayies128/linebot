# LINE Bot 統合システム 要件仕様書

## 1. プロジェクト概要

### 1.1 目的

LINE会話履歴を保存し、日常のタスク管理をサポートするシステムを構築する。

### 1.2 背景

- LINE上での会話の進捗状況を把握したい
- タスク管理の自動化・効率化を実現したい

### 1.3 スコープ

- LINE Messaging APIを使用したメッセージ受信・送信機能
- 会話履歴の保存
- タスク管理機能
- プライバシーとセキュリティを考慮したデータ処理

---

## 2. 機能要件

### 2.1 LINE連携機能

#### 2.1.1 メッセージ受信

- **Webhook対応**: LINE Messaging APIのWebhookを使用してメッセージをリアルタイムで受信
- **メッセージタイプ**: テキスト、画像、スタンプ、位置情報などの各種メッセージタイプに対応
- **グループ/個人チャット対応**: 個人チャットとグループチャットの両方に対応

#### 2.1.2 メッセージ送信

- **自動応答**: 特定のキーワードやパターンに基づく自動応答
- **リッチメッセージ**: Flex MessageやTemplate Messageを使用した視覚的なメッセージ送信

#### 2.1.3 会話履歴管理

- **履歴保存**: 会話履歴をデータベースに保存
- **進捗トラッキング**: 会話の進捗状況を追跡・分析
- **検索機能**: 過去の会話を検索可能にする

### 2.2 タスク管理機能

#### 2.2.1 タスク抽出

- **会話からタスク抽出**: LINE会話から自動的にタスクを抽出
- **進捗管理**: タスクの完了状況を追跡

#### 2.2.2 レポート機能

- **日次サマリー**: 1日の会話の要約とタスク一覧をLINEで送信
- **統計情報**: 会話量、タスク完了率などの統計

---

## 3. 非機能要件

### 3.1 セキュリティ・プライバシー

#### 3.1.1 データ保護

- **暗号化**: 保存データおよび通信データの暗号化
- **アクセス制御**: 認証・認可機能の実装
- **個人情報保護**: 日本の個人情報保護法等への準拠

#### 3.1.2 API認証

- **LINE**: Channel Access Tokenの安全な管理
- **環境変数管理**: 機密情報は環境変数で管理

### 3.2 パフォーマンス

#### 3.2.1 応答時間

- **Webhook応答**: 3秒以内にLINEサーバーへ応答
- **メッセージ送信**: 5秒以内にユーザーへメッセージ配信

#### 3.2.2 スケーラビリティ

- **同時接続**: 複数ユーザーの同時利用に対応

### 3.3 可用性・信頼性

#### 3.3.1 稼働率

- **目標稼働率**: 99.5%以上
- **エラーハンドリング**: 適切なエラー処理とログ記録

---

## 4. システム構成

### 4.1 アーキテクチャ

#### 4.1.1 システム構成図

```mermaid
[LINE Platform] ←→ [Vercel (NestJS Webhook)]
                              ↓
                    [Supabase (PostgreSQL)]
```

#### 4.1.2 採用技術スタック

- **言語**: TypeScript
- **フレームワーク**: NestJS (Node.js)
- **データベース**: Supabase (PostgreSQL)
- **ホスティング**: Vercel
- **LINE SDK**: @line/bot-sdk
- **ORM**: Prisma (Supabaseとの連携)

---

## 5. API仕様

### 5.1 LINE Messaging API

#### 5.1.1 使用エンドポイント

- **Webhook**: メッセージ受信
- **Reply API**: メッセージへの返信
- **Push API**: プッシュメッセージ送信
- **Profile API**: ユーザープロフィール取得

---

## 6. 開発フェーズ

### 6.1 フェーズ1: 基本機能（MVP）

- [x] LINE Webhook受信機能
- [x] 基本的なメッセージ応答
- [ ] 会話履歴保存

### 6.2 フェーズ2: 統合機能

- [ ] タスク抽出機能
- [ ] 進捗管理機能

---

## 7. ユーザーインターフェース

### 7.1 LINE Bot コマンド

#### 7.1.1 基本コマンド

- `/tasks`: タスク一覧を表示
- `/help`: ヘルプメッセージを表示
- `/settings`: 設定を表示
