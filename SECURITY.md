# ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

## æ©Ÿå¯†æƒ…å ±ã®ç®¡ç†

ã“ã®ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã¯ã€ä»¥ä¸‹ã®æ©Ÿå¯†æƒ…å ±ã‚’æ‰±ã„ã¾ã™ã€‚ã“ã‚Œã‚‰ã®æƒ…å ±ã¯**çµ¶å¯¾ã«GitHubã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„ã§ãã ã•ã„**ã€‚

### æ©Ÿå¯†æƒ…å ±ãƒªã‚¹ãƒˆ

- `LINE_CHANNEL_ACCESS_TOKEN` - LINE Messaging APIã‚¢ã‚¯ã‚»ã‚¹ãƒˆãƒ¼ã‚¯ãƒ³
- `LINE_CHANNEL_SECRET` - LINEãƒãƒ£ãƒãƒ«ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆ
- `SUPABASE_SERVICE_ROLE_KEY` - Supabaseã‚µãƒ¼ãƒ“ã‚¹ãƒ­ãƒ¼ãƒ«ã‚­ãƒ¼
- `DATABASE_URL` - ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æŽ¥ç¶šæ–‡å­—åˆ—ï¼ˆãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰å«ã‚€ï¼‰
- ãã®ä»–ã®APIã‚­ãƒ¼ã€ãƒˆãƒ¼ã‚¯ãƒ³ã€ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰

---

## .gitignoreã®ç¢ºèª

`.gitignore`ãƒ•ã‚¡ã‚¤ãƒ«ã«ä»¥ä¸‹ãŒå«ã¾ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„:

```gitignore
# ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆæ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ãŸã‚ï¼‰
.env
.env.local
.env.*.local

# Vercelè¨­å®š
.vercel
```

---

## ã‚³ãƒŸãƒƒãƒˆå‰ã®å¿…é ˆãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### âœ… ãƒã‚§ãƒƒã‚¯1: .envãƒ•ã‚¡ã‚¤ãƒ«ã®é™¤å¤–ç¢ºèª

```bash
git check-ignore -v .env
```

**æœŸå¾…ã•ã‚Œã‚‹å‡ºåŠ›:**

```text
.gitignore:5:.env       .env
```

ã“ã®å‡ºåŠ›ãŒè¡¨ç¤ºã•ã‚Œã‚Œã°ã€`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ­£ã—ãé™¤å¤–ã•ã‚Œã¦ã„ã¾ã™ã€‚

---

### âœ… ãƒã‚§ãƒƒã‚¯2: ã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã‚¨ãƒªã‚¢ã®ç¢ºèª

```bash
git status
```

**ç¢ºèªäº‹é …:**

- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ãŒã€ŒChanges to be committedã€ã«å«ã¾ã‚Œã¦ã„ãªã„ã“ã¨
- `.env.local`ã‚„`.env.production`ãªã©ã®ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ãŒå«ã¾ã‚Œã¦ã„ãªã„ã“ã¨

**ã‚‚ã—å«ã¾ã‚Œã¦ã„ã‚‹å ´åˆ:**

```bash
git reset .env
git reset .env.*
```

---

### âœ… ãƒã‚§ãƒƒã‚¯3: ã‚³ãƒŸãƒƒãƒˆå†…å®¹ã®ç¢ºèª

```bash
git diff --cached
```

**ç¢ºèªäº‹é …:**
ä»¥ä¸‹ã®ã‚ˆã†ãªæ©Ÿå¯†æƒ…å ±ãŒå«ã¾ã‚Œã¦ã„ãªã„ã‹ç¢ºèª:

- `LINE_CHANNEL_ACCESS_TOKEN=xxxxx`
- `LINE_CHANNEL_SECRET=xxxxx`
- `SUPABASE_SERVICE_ROLE_KEY=xxxxx`
- `DATABASE_URL=postgresql://postgres:PASSWORD@...`

---

### âœ… ãƒã‚§ãƒƒã‚¯4: ãƒ•ã‚¡ã‚¤ãƒ«åã®ç¢ºèª

```bash
git diff --cached --name-only
```

**é™¤å¤–ã™ã¹ããƒ•ã‚¡ã‚¤ãƒ«:**

- `.env`
- `.env.local`
- `.env.production`
- `.env.development`
- `.vercel`
- `prisma/migrations/` (ãƒžã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ã‚¡ã‚¤ãƒ«ã¯ç’°å¢ƒä¾å­˜ã®å¯èƒ½æ€§ã‚ã‚Š)

---

## è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã®è¨­å®šï¼ˆæŽ¨å¥¨ï¼‰

Git hooksã‚’ä½¿ç”¨ã—ã¦ã€ã‚³ãƒŸãƒƒãƒˆå‰ã«è‡ªå‹•çš„ã«ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œã§ãã¾ã™ã€‚

### pre-commitãƒ•ãƒƒã‚¯ã®ä½œæˆ

```bash
# .git/hooks/pre-commit ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆ
cat > .git/hooks/pre-commit << 'EOF'
#!/bin/bash

echo "ðŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿè¡Œä¸­..."

# .envãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚¹ãƒ†ãƒ¼ã‚¸ãƒ³ã‚°ã•ã‚Œã¦ã„ãªã„ã‹ç¢ºèª
if git diff --cached --name-only | grep -qE "^\.env"; then
    echo ""
    echo "âŒ ã‚¨ãƒ©ãƒ¼: ç’°å¢ƒå¤‰æ•°ãƒ•ã‚¡ã‚¤ãƒ«ãŒã‚³ãƒŸãƒƒãƒˆã«å«ã¾ã‚Œã¦ã„ã¾ã™"
    echo ""
    echo "æ¤œå‡ºã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«:"
    git diff --cached --name-only | grep "^\.env"
    echo ""
    echo "æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã‚³ãƒŸãƒƒãƒˆã§ãã¾ã›ã‚“"
    echo "ä»¥ä¸‹ã®ã‚³ãƒžãƒ³ãƒ‰ã§é™¤å¤–ã—ã¦ãã ã•ã„:"
    echo "  git reset .env"
    exit 1
fi

# æ©Ÿå¯†æƒ…å ±ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ãƒã‚§ãƒƒã‚¯
if git diff --cached | grep -qE "(CHANNEL_ACCESS_TOKEN|CHANNEL_SECRET|SERVICE_ROLE_KEY|CLIENT_SECRET|DATABASE_URL).*=.*[a-zA-Z0-9]{20,}"; then
    echo ""
    echo "âš ï¸  è­¦å‘Š: æ©Ÿå¯†æƒ…å ±ã‚‰ã—ãæ–‡å­—åˆ—ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
    echo ""
    echo "ã‚³ãƒŸãƒƒãƒˆå†…å®¹ã‚’ç¢ºèªã—ã¦ãã ã•ã„:"
    echo "  git diff --cached"
    echo ""
    read -p "ç¶šè¡Œã—ã¾ã™ã‹ï¼Ÿ (y/N): " -n 1 -r
    echo
    if [[ ! $REPLY =~ ^[Yy]$ ]]; then
        echo "ã‚³ãƒŸãƒƒãƒˆã‚’ä¸­æ­¢ã—ã¾ã—ãŸ"
        exit 1
    fi
fi

echo "âœ… ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒã‚§ãƒƒã‚¯å®Œäº†"
exit 0
EOF

# å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸Ž
chmod +x .git/hooks/pre-commit

echo "âœ… pre-commitãƒ•ãƒƒã‚¯ã‚’è¨­å®šã—ã¾ã—ãŸ"
```

---

## ä¸‡ãŒä¸€æ©Ÿå¯†æƒ…å ±ã‚’ã‚³ãƒŸãƒƒãƒˆã—ã¦ã—ã¾ã£ãŸå ´åˆ

### ã¾ã pushã—ã¦ã„ãªã„å ´åˆ

```bash
# æœ€æ–°ã®ã‚³ãƒŸãƒƒãƒˆã‚’å–ã‚Šæ¶ˆã™
git reset --soft HEAD~1

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¿®æ­£ã—ã¦ã‹ã‚‰å†ã‚³ãƒŸãƒƒãƒˆ
```

### ã™ã§ã«pushã—ã¦ã—ã¾ã£ãŸå ´åˆ

**ç›´ã¡ã«ä»¥ä¸‹ã®å¯¾å¿œã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„:**

1. **ãƒˆãƒ¼ã‚¯ãƒ³ãƒ»ã‚­ãƒ¼ã®ç„¡åŠ¹åŒ–**
   - LINE Developers: Channel Access Tokenã‚’å†ç™ºè¡Œ
   - Supabase: Service Role Keyã‚’ãƒªã‚»ãƒƒãƒˆ
   - Google Cloud: OAuthèªè¨¼æƒ…å ±ã‚’å‰Šé™¤ã—ã¦å†ä½œæˆ

2. **Gitå±¥æ­´ã‹ã‚‰å®Œå…¨ã«å‰Šé™¤**

```bash
# BFG Repo-Cleanerã‚’ä½¿ç”¨ï¼ˆæŽ¨å¥¨ï¼‰
# https://rtyley.github.io/bfg-repo-cleaner/

# ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆHomebrewï¼‰
brew install bfg

# æ©Ÿå¯†æƒ…å ±ã‚’å«ã‚€ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‰Šé™¤
bfg --delete-files .env

# ã¾ãŸã¯ã€git filter-branchã‚’ä½¿ç”¨
git filter-branch --force --index-filter \
  "git rm --cached --ignore-unmatch .env" \
  --prune-empty --tag-name-filter cat -- --all

# å¼·åˆ¶push
git push origin --force --all
```

1. **ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼ã¸ã®é€šçŸ¥**
   - æ©Ÿå¯†æƒ…å ±ãŒæ¼æ´©ã—ãŸå¯èƒ½æ€§ã‚’é€šçŸ¥
   - ãƒªãƒã‚¸ãƒˆãƒªã®å†ã‚¯ãƒ­ãƒ¼ãƒ³ã‚’ä¾é ¼

---

## ç’°å¢ƒå¤‰æ•°ã®å®‰å…¨ãªç®¡ç†

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒ

- `.env`ãƒ•ã‚¡ã‚¤ãƒ«ã«æ©Ÿå¯†æƒ…å ±ã‚’è¨˜è¼‰
- `.env.example`ã«ã¯ã‚µãƒ³ãƒ—ãƒ«å€¤ã®ã¿è¨˜è¼‰
- `.env`ã¯çµ¶å¯¾ã«ã‚³ãƒŸãƒƒãƒˆã—ãªã„

### Vercelï¼ˆæœ¬ç•ªç’°å¢ƒï¼‰

1. Vercelãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã§ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®š
2. ç’°å¢ƒå¤‰æ•°ã¯æš—å·åŒ–ã•ã‚Œã¦ä¿å­˜ã•ã‚Œã‚‹
3. ãƒ‡ãƒ—ãƒ­ã‚¤æ™‚ã«è‡ªå‹•çš„ã«æ³¨å…¥ã•ã‚Œã‚‹

### ãƒãƒ¼ãƒ å…±æœ‰

- æ©Ÿå¯†æƒ…å ±ã¯1Passwordã€LastPassãªã©ã®ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒžãƒãƒ¼ã‚¸ãƒ£ãƒ¼ã§å…±æœ‰
- Slackã‚„ãƒ¡ãƒ¼ãƒ«ã§APIã‚­ãƒ¼ã‚’é€ä¿¡ã—ãªã„
- å¿…è¦ã«å¿œã˜ã¦æš—å·åŒ–ãƒ„ãƒ¼ãƒ«ï¼ˆgpgã€ageç­‰ï¼‰ã‚’ä½¿ç”¨

---

## ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

1. **å®šæœŸçš„ãªãƒˆãƒ¼ã‚¯ãƒ³ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³**
   - 3ãƒ¶æœˆã”ã¨ã«APIã‚­ãƒ¼ã‚’æ›´æ–°
   - ä½¿ç”¨ã—ã¦ã„ãªã„ãƒˆãƒ¼ã‚¯ãƒ³ã¯å‰Šé™¤

2. **æœ€å°æ¨©é™ã®åŽŸå‰‡**
   - å¿…è¦æœ€å°é™ã®æ¨©é™ã®ã¿ä»˜ä¸Ž
   - Service Role Keyã¯ç®¡ç†æ“ä½œã®ã¿ã«ä½¿ç”¨

3. **ç›£æŸ»ãƒ­ã‚°ã®ç¢ºèª**
   - Supabaseã€LINEã€Googleã®ç›£æŸ»ãƒ­ã‚°ã‚’å®šæœŸçš„ã«ç¢ºèª
   - ä¸å¯©ãªã‚¢ã‚¯ã‚»ã‚¹ãŒãªã„ã‹ãƒã‚§ãƒƒã‚¯

4. **2è¦ç´ èªè¨¼ã®æœ‰åŠ¹åŒ–**
   - GitHubã€Vercelã€Supabaseç­‰ã§2FAã‚’æœ‰åŠ¹åŒ–

---

## ç·Šæ€¥é€£çµ¡å…ˆ

æ©Ÿå¯†æƒ…å ±ã®æ¼æ´©ã‚’ç™ºè¦‹ã—ãŸå ´åˆã¯ã€ç›´ã¡ã«ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç®¡ç†è€…ã«é€£çµ¡ã—ã¦ãã ã•ã„ã€‚

---

## å‚è€ƒãƒªãƒ³ã‚¯

- [GitHub: Removing sensitive data from a repository](https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/removing-sensitive-data-from-a-repository)
- [LINE Developers: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£](https://developers.line.biz/ja/docs/messaging-api/security/)
- [Supabase: Security](https://supabase.com/docs/guides/platform/security)
